<!DOCTYPE html>
<html lang="zxx">

  <head>
    <meta charset="UTF-8">
    <meta name="description"
      content="Male_Fashion Timeless Jewelry & Elegant Rings for Every Occasion">
    <meta name="keywords" content="Male_Fashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Product | Veroroma | Timeless Jewelry & Elegant Rings for Every
      Occasion</title>
    <link rel="shortcut icon" href="../img/favicon.png" type="image/x-icon">
    <!-- Google Font -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous">
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
      integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Css Styles -->
    <link rel="stylesheet" href="../css/style.css" type="text/css">
  </head>

  <body>
    <!-- =========== MAIN CODE START ============= -->
    <main>

      <div class="d-flex align-items-start container-fluid p-3 h_100vh">
        <div id="nav_pills" class="col-lg-2 h-100"></div>
        <div class="tab-content col-lg-10 " id="v-pills-tabContent">
          <!-- =========== HOME CODE START ============== -->
          <div class="tab-pane fade show active" id="v-pills-home"
            role="tabpanel"
            aria-labelledby="v-pills-home-tab" tabindex="0">

            <div class="col-12 mx-0">
              <!-- ========= SEARCH CODE START ========= -->
              <div class="container-fluid mb-3">
                <div class="row">
                  <div class="col-lg-11">
                    <input type="search" class="form-control"
                      placeholder="Seach Here">
                  </div>
                  <div class="col-lg-1">
                    <button id="logout-btn"
                      class="bg_grey border-0 shadow-sm px-3 py-2">Logout</button>

                  </div>
                </div>
              </div>
              <!-- ========= SEARCH CODE End ========= -->
          <!-- ====== TOP CARD'S CODE START ======== -->
                            <div class="container-fluid">
                                <div class="row justify-content-between">
                                    <div class="col-lg-3 col-12">
                                        <div
                                            class="col-12 border px-2 py-2 rounded-3">
                                            <div
                                                class="d-flex flex-row justify-content-between align-items-center">
                                                <h5>Total Products </h5>
                                                <div
                                                    class="bg_light p-2 rounded-3">
                                                    <i
                                                        class="fa-solid fa-gift  "></i>
                                                </div>
                                            </div>
                                            <p class="fs-4 " id="product_lenght"></p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-12">
                                        <div
                                            class="col-12 border px-2 py-2 rounded-3">
                                            <div
                                                class="d-flex flex-row justify-content-between align-items-center">
                                                <h5>Categories </h5>
                                                <div
                                                    class="bg_light p-2 rounded-3">
                                                    <i class="fa fa-list-alt"
                                                        aria-hidden="true"></i>
                                                </div>
                                            </div>
                                            <p class="fs-4 " id="category_lenght"></p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-12">
                                        <div
                                            class="col-12 border px-2 py-2 rounded-3">
                                            <div
                                                class="d-flex flex-row justify-content-between align-items-center">
                                                <h5>Buyer </h5>
                                                <div
                                                    class="bg_light p-2 rounded-3">
                                                    <i
                                                        class="fa-solid fa-user"></i>
                                                </div>
                                            </div>
                                            <p class="fs-4 ">0</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-12">
                                        <div
                                            class="col-12 border px-2 py-2 rounded-3">
                                            <div
                                                class="d-flex flex-row justify-content-between align-items-center">
                                                <h5>Total Users </h5>
                                                <div
                                                    class="bg_light p-2 rounded-3">
                                                    <i
                                                        class="fa-solid fa-gift  "></i>
                                                </div>
                                            </div>
                                            <p class="fs-4 ">0</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- ====== TOP CARD'S CODE END ======== -->
              <!-- ========== ADD PRODUCT CODE START ============= -->
              <div class="container-fluid py-2 px-3">

                <!-- ======== MANAGE PRODCUT CODE START ======== -->
                <div class="row  py-1">
                  <div
                    class="col-lg-12 d-flex flex-row justify-content-between align-items-center">
                    <h5>Manage Categorize</h5>
                    <h5>Total Categorize : <span id="total_product">
                        <div
                          class="spinner-border spinner-border-sm  fw-lighter"
                          role="status">
                          <span class="visually-hidden">Loading...</span>
                        </div>
                      </span></h5>
                  </div>
                </div>
                <!-- ======== MANAGE PRODCUT CODE END ======== -->

           

                <div
                  class="row py-2 col-lg-12 rounded-3 mx-auto border rounded-3 row_product">
                  <table class="table  proudct_table">
                    <thead
                      class="table-dark rounded-3 py-3 position-sticky top-0">
                      <tr>
                        <th class="col-1">#</th>
                        <th class="col-3"> Category Name</th>
                   
            
                        <th class="col-2">Image</th>
                        <th class="col-2">Crud</th>

                      </tr>
                    </thead>
                    <tbody id="prodcut_of_home_page">

                    </tbody>
                  </table>

                </div>
              </div>
              <!-- ========== ADD PRODUCT CODE END ============= -->

            </div>
          </div>
          <!-- =========== HOME CODE START ============== -->

        </div>
      </div>

      <!-- ============= EDIT PRODUCT CODE START ================= -->
      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content" id="modal_content">
            <div class="modal-body py-3">
              <div class="my-2">
                <h4 class="text-center">Update Product</h4>
              </div>
              <div class="mb-2 col-11 mx-auto">
                <input type="text" id="update_name" class="form-control"
                  placeholder="Product Name">
              </div>
              <div class="mb-2 col-11 mx-auto">
                <input type="text" id="update_price" class="form-control"
                  placeholder="Price">
              </div>
              <div class="mb-2 col-11 mx-auto">
                <input type="text" id="update_image" class="form-control"
                  placeholder="Image URL">
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn"
                data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn  save_btn">Save changes</button>
            </div>
          </div>
        </div>
      </div>
      <!-- =========== EDIT PRODUCT CODE END ====================== -->
    </main>
    <!-- ============= MAIN CODE END ============= -->

    <!-- Js Plugins -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous">
        </script>

    <!-- Firebase and App Scripts -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

  import { getFirestore, collection, getDocs,getDoc,doc ,deleteDoc, updateDoc} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    const firebaseConfig = {
      apiKey: "AIzaSyC1zoSG4uMziRnA1Iaiz5r-9UBbHwJTRD8",
  authDomain: "veroroma-1a37b.firebaseapp.com",
  projectId: "veroroma-1a37b",
  storageBucket: "veroroma-1a37b.appspot.com",
  messagingSenderId: "738682652885",
  appId: "1:738682652885:web:7dabde8d7285773e757a5c",
  measurementId: "G-LVGP1FPRMQ"
};
const app = initializeApp(firebaseConfig);

 
    

const db = getFirestore(app);
    // ========== DOM References ==========
document.addEventListener("DOMContentLoaded", async () => {
  const categorySelect = document.getElementById("category");
  const productsTable = document.getElementById("prodcut_of_home_page");

  try {
    // Load Categories
    const categorySnapshot = await getDocs(collection(db, "categories"));
    categorySnapshot.forEach((doc) => {
      const data = doc.data();
      const option = document.createElement("option");
      option.value = data.name;
      option.textContent = data.name;
      categorySelect.appendChild(option);
    });

    // Load Products when category changes
    categorySelect.addEventListener("change", async () => {
      const selectedCategory = categorySelect.value;
      productsTable.innerHTML = ""; // clear old data

      const productSnapshot = await getDocs(collection(db, "categories"));
      let count = 1;

      productSnapshot.forEach((doc) => {
        const product = doc.data();

        if (selectedCategory === "" || product.category === selectedCategory) {
          productsTable.innerHTML += `
                <tr class="table-light custrom_tr">
          <td class="fw-light col-1">${count++}</td>
          <td class="py-2 col-3">${product.name}</td>
          <td class="py-2 col-3 img-g">
            <img src="${product.image1 ? product.image1 : ""}" 
                 class="img-fluid col-9 rounded-2 bg_light img_of_tabke" 
                 alt="${product.name}">
          </td>
          <td class="py-2 col-1">
            <button type="button" class="edit_product bg-white col-5 px-1 py-2 border-0 shadow-sm rounded-3"
              data-id="${doc.id}" data-bs-toggle="modal" data-bs-target="#exampleModal">
              <i class="fas fa-edit"></i>
            </button>
            <button class="bg-white px-1 py-2 col-5 border-0 shadow-sm rounded-3 delete_product"
              data-id="${doc.id}">
              <i class="fa-solid fa-trash"></i>
            </button>
          </td>
        </tr>
          `;
        }
      });
    });
  } catch (error) {
    console.error("❌ Error:", error);
  }
});

    
// ========== FETCH PRODUCT IS HOME PAGE START ================
var prodcut_of_home_page = document.getElementById("prodcut_of_home_page");
var allproduct=[]
prodcut_of_home_page.innerHTML=`
<div class="container-fluid d-flex flex-row justify-content-center align-items-center">
  <div class="spinner-border text-center" role="status">
<span class="visually-hidden">Loading...</span>
</div>
  </div>
`

var modal_content=document.getElementById("modal_content");
if (prodcut_of_home_page) {
let allproduct = [];

async function fetchProducts() {
  try {
    const querySnapshot = await getDocs(collection(db, "categories"));
    allproduct = []; // reset array

    querySnapshot.forEach((doc) => {
      allproduct.push({ doc }); // ✅ correct push
    });

    // render first time
    renderProducts(allproduct);

    // total count
    document.getElementById("total_product").innerHTML = allproduct.length;
  } catch (error) {
    prodcut_of_home_page.innerHTML = `
      <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    `;
  }
}

function renderProducts(products) {
  prodcut_of_home_page.innerHTML = products
    .map((e, index) => {
      console.log(e.doc.data());
      
      return `
        <tr class="table-light custrom_tr">
          <td class="fw-light col-1">${index + 1}</td>
          <td class="py-2 col-3">${e.doc.data().name}</td>
         <td class="py-2 col-3 img-g">
            <img src="${e.doc.data().imgUrl ? e.doc.data().imgUrl : ""}" 
                 class="img-fluid col-9 rounded-2 bg_light img_of_tabke" 
                 alt="${e.doc.data().name}">
          </td>
          <td class="py-2 col-1">
            <button type="button" class="edit_product bg-white col-5 px-1 py-2 border-0 shadow-sm rounded-3"
              data-id="${e.doc.id}" data-bs-toggle="modal" data-bs-target="#exampleModal">
              <i class="fas fa-edit"></i>
            </button>
            <button class="bg-white px-1 py-2 col-5 border-0 shadow-sm rounded-3 delete_product"
              data-id="${e.doc.id}">
              <i class="fa-solid fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    })
    .join("");
}

// ✅ Search ek hi baar bind hoga
document.addEventListener("input", () => {
  const search_product = document.getElementById("search_product").value.trim().toLowerCase();

  const filtered = allproduct.filter((e) =>
    e.doc.data().name.toLowerCase().includes(search_product)
  );

  renderProducts(filtered);
  document.getElementById("total_product").innerHTML = filtered.length;
});

fetchProducts();
}

// ======= EDIT PRODUCT CODE START ============
// ======= EDIT PRODUCT CODE START ============
setTimeout(() => {
  // Sare edit buttons pe listener lagao
  document.querySelectorAll(".edit_product").forEach((btn) => {
    btn.addEventListener("click", async (e) => {
      const productId = e.target.closest("button").getAttribute("data-id");
      console.log("Edit Clicked:", productId);

      // Modal ko id attach kar do
      const modal = document.getElementById("exampleModal");
      modal.setAttribute("data-id", productId);

      // Firestore se product ka data lao
      try {
        const docRef = doc(db, "categories", productId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();
console.log(data);

       document.getElementById("update_name").value = data.name || "";
  document.getElementById("update_price").value = data.categoryId
 || "";
  document.getElementById("update_image").value = data.imgUrl || "";
        } else {
        
        }
      } catch (error) {
      
      }
    });
  });

  // Save button pe listener
  document.querySelectorAll(".save_btn").forEach((btn) => {
    btn.addEventListener("click", async (e) => {
      const modal = e.target.closest(".modal");
      const productId = modal.getAttribute("data-id");
   

      // New values input se lo
      const newName = document.getElementById("update_name").value;
      const newPrice = document.getElementById("update_price").value;
      const newImage = document.getElementById("update_image").value;

      try {
        const docRef = doc(db, "categories", productId);

        await updateDoc(docRef, {
          name: newName,
          categoryId: newPrice,
         imgUrl: newImage,
        });

        console.log("✅ Product updated:", productId);

        // Bootstrap modal close karo
        const bsModal = bootstrap.Modal.getInstance(modal);
        bsModal.hide();

        fetchProducts(); // Table ko refresh karo
location.reload()
      } catch (error) {
    
      }
    });
  });

document.querySelectorAll(".delete_product").forEach((btn) => {
  btn.addEventListener("click", async (e) => {

    const productId = e.target.closest("button").getAttribute("data-id"); // button ke data-id se product id lo
    if (!productId) return;

    if (confirm("⚠️ Are you sure you want to delete this product?")) {
      try {
        await deleteDoc(doc(db, "categories", productId));
        console.log("✅ Product deleted:", productId);

        // Table ko refresh karne ke liye function call
        fetchProducts();
      } catch (error) {
        console.error("🔥 Error deleting product:", error);
      }
    }
  });
});



}, 2500);
// ======= EDIT PRODUCT CODE END ============


// =========== FETCH PRODUCT IS HOME PAGE END ===============


    </script>
    <script src="js/app.js" type="module"></script>
  </body>

</html>